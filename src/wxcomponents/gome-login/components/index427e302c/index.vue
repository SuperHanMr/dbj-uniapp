<template>
<uni-shadow-root class="gome-login-components-index427e302c-index"><view class="authory-container" :style="(themeStyle)+';'+((mpxShow)||(mpxShow)===undefined?'':'display:none;')"><view class="authory-phone-wrapper" v-if="isShowAuthoryPhone"><image mode="aspectFit" :src="avatarUrl" class="avatar"></image> <view class="nickname">{{ nickName }}</view>   <button :disabled="(!isSelectAuthoryAgreement)" hover-class="authory-btn--hover" open-type="getPhoneNumber" @getphonenumber="getPhoneNumber" :class="("authory-phone-button confirm"+("wx"==="ali"&&(!isSelectAuthoryAgreement)?"-not":""))"><image src="../../img/weixin.c10fa53e.png" class="img" v-if="platForm === 'wx'"></image>授权手机号一键绑定</button> <view @click="switchDiffAuthory" class="use-phone-bind">使用其他手机号</view></view> <view class="login-wrapper" v-else><image mode="aspectFit" src="../../img/logo.0ccb88de.png" class="logo"></image> <view><view class="verify-boxs"><view class="verify-list input-phone"><view class="input-box"><image src="../../img/phone-icon.5d716ece.png" class="image-icon"></image> <input placeholder-style="font-size: 29rpx;color: #bfbfbf;" placeholder="请输入手机号" type="number" maxlength="11" @input="bindPhoneInput" @focus="bindPhoneFocus" @blur="bindPhoneBlur" :focus="phoneFocus" :value="phone" class="input"></input> <image src="../../img/close-icon.fc45a809.png" @click="bindClearPhone" :class="'clear '+(phoneClear ? 'show' : '')"></image></view></view></view> <view :hidden="showPhoneError" class="error">请输入正确的手机号</view> <view class="verify-boxs"><view class="verify-list"><view class="input-box"><image src="../../img/key-icon.0f5d0462.png" class="image-icon"></image> <input placeholder-style="font-size: 29rpx;color: #bfbfbf;" placeholder="请输入验证码" type="number" @input="bindCodeInput" @focus="bindCodeFocus" @blur="bindCodeBlur" :value="code" class="input"></input> <image src="../../img/close-icon.fc45a809.png" @click="bindClearCode" :class="'clear '+(codeClear ? 'show' : '')"></image></view> <button :disabled="codeIsClick" @click="bindGetCode" :class="("code"+("wx"==="ali"&&(codeIsClick)?"-not":""))">{{ codeTxt }}</button></view> <view :hidden="(!codeError)" class="error">{{ codeError }}</view></view> <view :hidden="relationCode == relationNewUserCode ? false : true" class="verify-boxs"><view class="verify-list"><view class="input-box"><image src="../../img/lock.b8cb9367.png" class="image-icon"></image>  <input placeholder-style="font-size: 28rpx;color: #bfbfbf;" placeholder="请设置密码，6-20位数字、字母或字符" type="password" minlength="6" maxlength="20" @input="bindPasswordInput" @blur="bindPasswordBlur" @focus="bindPasswordFocus" :value="password" class="input"></input> <image src="../../img/close-icon.fc45a809.png" @click="bindClearPassword" :class="'clear '+(passwordClear ? 'show' : '')"></image></view></view></view> <view :hidden="(!passwordError)" class="error">{{ passwordError }}</view></view> <button :disabled="(!isSelectAuthoryAgreement || confirmIsClick)" @click="bindConfirm" :class="("confirm"+("wx"==="ali"&&(!isSelectAuthoryAgreement || confirmIsClick)?"-not":""))">完成</button>   <button :disabled="(!isSelectAuthoryAgreement)" open-type="getPhoneNumber" @getphonenumber="getPhoneNumber" :class="("authory-phone-button confirm"+("wx"==="ali"&&(!isSelectAuthoryAgreement)?"-not":""))"><image src="../../img/weixin.c10fa53e.png" class="img" v-if="platForm === 'wx'"></image>授权手机号一键绑定</button></view> <view class="agreement-box" v-if="isShowFooter"><checkbox-group @change="bindAuthoryRadioChange" class="radio-group"><label><checkbox value="1" :color="checkboxThemeColor" :checked="isSelectAuthoryAgreement" class="checkbox"></checkbox>绑定手机号即代表您同意</label></checkbox-group> <block v-for="(business,index) in (businessObj)" :key="business.index"><navigator :url="(nativePage)+'?url='+(business.protocolUrl)" class="navStyle">{{ business.name }}</navigator></block></view> <view class="bind-mask" v-if="bindState"><view class="bind-box"><view class="bind-tit"><view>更换绑定第三方平台账号须知</view> <image @click="closeLayer" src="../../img/close.5bdc4fee.png" class="img"></image></view> <view class="layer-h2"><view>变更绑定同一第三方平台账号须知如下：</view> <view>1）变更后您的资产不发生任何变化。</view> <view>2）变更绑定同一第三方平台内账号的30天内无法进行二次解绑。</view> <view>请您知悉。</view></view></view> <view class="bind-btn"><view @click="switchDiffAuthory" class="change-phone">更换手机号</view> <view @click="bindPhoneEvent" class="bind-phone">继续绑定</view></view></view> <view :hidden="confirmMask" class="mask"></view></view></uni-shadow-root>
</template>

<script>

global['__wxRoute'] = 'gome-login/components/index427e302c/index'
var window=window||{};window.webpackJsonp=require("../../bundle.js"),module.exports=(window.webpackJsonp=window.webpackJsonp||[]).push([["components/index427e302c/index"],{"./src/components/newUserReg/index.js?packageName=main&resourcePath=%2FUsers%2Ffwind%2Fgome%2Fgitlab%2Fgome-mini%2Fpackages%2Flogin%2Fsrc%2Fcomponents%2FnewUserReg%2Findex.mpx":function(e,t,o){"use strict";var s=o("./src/utils/apis.js"),n=o("./src/utils/regular.js"),i=o("./src/utils/index.js"),a=o("./src/constants.js");Component({properties:{loginData:{type:Object,value:{}}},data:{isShowAuthoryPhone:!0,showPhoneError:!0,codeIsClick:!0,codeError:"",countdownTemp:120,confirmIsClick:!0,confirmMask:!0,relationCode:"",relationNewUserCode:1001,passwordError:"",phone:"",code:"",password:"",phoneClear:!1,codeClear:!1,phoneFocus:!1,passwordClear:!1,codeTxt:"获取验证码",isSelectAuthoryAgreement:!0,loginCode:"",avatarUrl:"",nickName:"",isWechatBindStatus:!1,bindState:!1,platForm:"",isShowFooter:!0,distinctId:"",whereFromStr:"",themeStyle:a.a,checkboxThemeColor:"#B20FD3",nativePage:"/pages/active/active"},lifetimes:{attached(){const{avatarUrl:e,avatar:t,nickName:o=""}=Object(i.b)("userInfo"),{appId:s,ctx:n,sharerUnionId:a,sharerUserId:r,platForm:c,distinctId:h="",whereFromStr:d="",themeConfig:l,nativePage:u}=this.data.loginData;if(this.setData({avatarUrl:e||t,nickName:o,appId:s,ctx:n,sharerUnionId:a,sharerUserId:r,platForm:c,distinctId:h,whereFromStr:d,nativePage:u}),l){const{backgroundColor:e,fontColor:t}=l;let o="";e&&(o+=`--background-color:${e};`,this.setData({checkboxThemeColor:e})),t&&(o+=`--font-color:${t};`),this.setData({themeStyle:o})}this.authoryLogin(),this.getUserAgreement()}},methods:{getUserAgreement:function(){const e=this,{appId:t,ctx:o}=this.data,n={appId:t,useType:"0"};s.a.getAppletProtocolInfoList(n,o,{success(t){const{code:o,businessObj:s,message:n}=t.data;0===o?e.setData({businessObj:s}):wx.showToast({title:n||"系统忙，请稍后再试",icon:"none",mask:!0})}})},bindPhoneInput:function(e){const t=e.detail.value,o=t.length;let s=!0;11==o&&(s=!1),this.setData({codeIsClick:s,phone:t,codeError:!1,phoneClear:!!o}),this.dealConfirmIsClick()},bindPhoneFocus:function(e){const t=e.detail.value;this.setData({showPhoneError:!0,phoneClear:!!t,isShowFooter:!1})},bindPhoneBlur:function(){this.setData({phoneClear:!1,codeError:!1,isShowFooter:!0})},bindClearPhone:function(){this.setData({phone:"",phoneClear:!1,codeIsClick:!0}),this.dealConfirmIsClick()},bindCodeInput:function(e){const t=e.detail.value,o=t.length;this.setData({code:t,codeClear:!!o}),this.dealConfirmIsClick()},bindCodeFocus:function(e){const t=e.detail.value;this.setData({codeError:"",codeClear:!!t,isShowFooter:!1})},bindCodeBlur:function(){this.setData({codeClear:!1,isShowFooter:!0})},bindClearCode:function(){this.setData({code:"",codeClear:!1}),this.dealConfirmIsClick()},bindGetCode:function(){const{phone:e}=this.data;Object(n.b)(e)?this.setData({showPhoneError:!1}):this.dealAuthoryCode()},bindPasswordFocus:function(e){const t=e.detail.value;this.setData({passwordError:"",passwordClear:!!t,isShowFooter:!1})},bindPasswordInput:function(e){const t=e.detail.value,o=t.length;this.setData({password:t,passwordClear:!!o}),this.dealConfirmIsClick()},bindPasswordBlur:function(){this.checkPasswordHandler(),this.setData({passwordClear:!1,isShowFooter:!0})},bindClearPassword:function(){this.setData({password:"",passwordClear:!1}),this.dealConfirmIsClick()},bindAuthoryRadioChange:function(e){const t=e.detail.value.join("");this.setData({isSelectAuthoryAgreement:!!t})},bindConfirm:function(){this.dealCompleteRelation()},dealCompleteRelation:function(e){const t=this,{appId:o,distinctId:a,relationCode:r,relationNewUserCode:c,password:h,code:d,isSelectAuthoryAgreement:l,sharerUserId:u,sharerUnionId:p,ctx:m,whereFromStr:w}=this.data,C=e||this.data.phone,g=Object(i.b)("setUnionId");let f=0;const b=Object(i.b)("userInfo"),F={appId:o,phoneNum:C,snsUserId:g,isWechatBind:e?1:0,puserId:u,puniqueId:p,headimg:b.avatarUrl?null!=b.avatarUrl?b.avatarUrl:"":b.avatar?b.avatar:"",snsUserName:null!=b.nickName?b.nickName:""};if(w&&(F.whereFrom=w),a&&(F.distinctId=a),!l)return wx.showModal({title:"提示",content:"请您确认勾选绑定手机号协议",cancelText:"取消",confirmText:"确定"}),!1;if(!e&&(F.msgCode=d,Object(n.b)(C)))return this.setData({showPhoneError:!1}),!1;if(r==c)if(f=1,F.pwd=h,e)F.pwd="SNS_GOME_PWD";else if(this.checkPasswordHandler())return!1;e||this.setData({confirmMask:!1}),s.a.checkPassword(F,f,m,{success(o){const{code:s,message:n,extParams:i}=o.data;e||t.setData({confirmMask:!0}),t.triggerEvent("onRelation",{code:s,message:n,extParams:i,phone:t.data.phone})},catch(o){e||t.setData({confirmMask:!0})}})},switchDiffAuthory:function(){this.setData({isShowAuthoryPhone:!1,bindState:!1,phone:"",phoneClear:!1})},onGetAuthorize:function(e){let t=this;const{isSelectAuthoryAgreement:o}=this.data;o?my.getPhoneNumber({success:e=>{const o=JSON.parse(e.response),{response:s,sign:n}=o,i={encryptedData:s,signature:n};t.getPhoneNumberForWeApp(i)},fail:e=>{}}):wx.showModal({title:"提示",content:"请您确认勾选绑定手机号协议",cancelText:"取消",confirmText:"确定"})},getPhoneNumber:function(e){const t=this,{encryptedData:o,iv:s,errMsg:n}=e.detail;if("getPhoneNumber:ok"==n){const e={encryptedData:o,iv:s};wx.checkSession({success(o){t.getPhoneNumberForWeApp(e)},fail(){t.authoryLogin((()=>{t.getPhoneNumberForWeApp(e)}))}})}else"getPhoneNumber:fail platform auth deny"==n?this.setData({isShowAuthoryPhone:!1}):(this.authoryLogin(),n.includes("auth deny")||wx.showToast({title:"请授权允许获取手机号后重试！",icon:"none",duration:2e3}))},getPhoneNumberForWeApp:function(e){const t=this,{loginCode:o,appId:n,ctx:i,whereFromStr:a}=this.data;e.code=o,e.appId=n,a&&(e.whereFromStr=a),s.a.getPhoneNumber(e,i,{success(e){const{code:o,phoneNumber:s,message:n}=e.data;if(t.authoryLogin(),200==o){const e=s;t.setData({phone:e,isWechatBindStatus:!0}),t.dealAuthoryCode(1,0)}else t.setData({isWechatBindStatus:!1}),wx.showToast({title:n||"系统忙，请稍后再试",icon:"none",mask:!0,duration:2e3})}})},authoryLogin(e){const t=this,{platForm:o}=this.data;wx["swan"===o?"getLoginCode":"login"]({success(o){o.code&&(t.setData({loginCode:o.code}),e&&e())}})},dealAuthoryCode:function(e="",t=""){const o=this,{appId:n,phone:a,platForm:r,ctx:c,whereFromStr:h}=this.data,d=Object(i.b)("setUnionId"),l={appId:n,phoneNum:a,snsUserId:d,isWechatBind:e,isChangeBind:"wx"==r?t:""};h&&(l.whereFrom=h),s.a.getRelationPhoneCode(l,c,{success(e){const{data:s}=e,{code:n}=s;o.setData({relationCode:n}),o.triggerEvent("onPhoneCode",{code:n,data:s,isChangeBind:t,phone:a})}})},dealCountdown:function(){let{countdownTemp:e}=this.data;e>1?(this.data.countdownTemp--,this.setData({codeIsClick:!0,codeTxt:`${e}s`}),setTimeout((()=>{this.dealCountdown()}),1e3)):this.setData({codeIsClick:!1,countdownTemp:120,codeTxt:"重新获取"})},dealConfirmIsClick:function(){const{phone:e,code:t,password:o,relationCode:s,isSelectAuthoryAgreement:i,relationNewUserCode:a}=this.data,r=!Object(n.d)(t);let c=!0;11!=e.length||r||(c=!1),c||(c=2e3!=s&&s!=a,s==a&&(c=o.length<6)),this.setData({confirmIsClick:c})},checkPasswordHandler(){const{password:e}=this.data,{error:t,status:o}=Object(n.a)(e);return o&&this.setData({passwordError:t}),o},closeLayer:function(){this.setData({bindState:!1})},bindPhoneEvent:function(){const{isWechatBindStatus:e}=this.data;this.setData({bindState:!1}),e?this.dealAuthoryCode(1,1):this.dealAuthoryCode(0,1)},tipsShowModal(e){let t=this;wx.showModal({title:"提示",content:e,cancelText:"更换号码",confirmText:"联系客服",confirmColor:"#F66A6B",success:function(e){e.confirm?wx.showModal({content:"400-811-3333"}):e.cancel&&t.setData({phone:"",code:"",isShowAuthoryPhone:!1,phoneClear:!1,codeClear:!1,codeIsClick:!1,codeTxt:"获取验证码",countdownTemp:120,phoneFocus:!0})}})}}})},"./src/components/newUserReg/index.mpx?packageName=main":function(e,t,o){"use strict";o.r(t),function(e){e.currentModuleId="md12dfe6e",e.currentCtor=Component,e.currentCtorType="component",e.currentSrcMode="wx",e.currentInject={moduleId:"md12dfe6e",render:function(){this._c("themeStyle",this.themeStyle),this._c("mpxShow",this.mpxShow)||this._c("mpxShow",this.mpxShow),this._c("isShowAuthoryPhone",this.isShowAuthoryPhone)?(this._c("avatarUrl",this.avatarUrl),this._c("nickName",this.nickName),this._c("isSelectAuthoryAgreement",this.isSelectAuthoryAgreement),this._c("platForm",this.platForm)):(this._c("phoneFocus",this.phoneFocus),this._c("phone",this.phone),this._c("phoneClear",this.phoneClear),this._c("showPhoneError",this.showPhoneError),this._c("code",this.code),this._c("codeClear",this.codeClear),this._c("codeIsClick",this.codeIsClick),this._c("codeTxt",this.codeTxt),this._c("codeError",this.codeError),this._c("codeError",this.codeError),this._c("relationCode",this.relationCode),this._c("relationNewUserCode",this.relationNewUserCode),this._c("password",this.password),this._c("passwordClear",this.passwordClear),this._c("passwordError",this.passwordError),this._c("passwordError",this.passwordError),!this._c("isSelectAuthoryAgreement",this.isSelectAuthoryAgreement)||this._c("confirmIsClick",this.confirmIsClick),this._c("isSelectAuthoryAgreement",this.isSelectAuthoryAgreement),this._c("platForm",this.platForm)),this._c("isShowFooter",this.isShowFooter)&&(this._c("checkboxThemeColor",this.checkboxThemeColor),this._c("isSelectAuthoryAgreement",this.isSelectAuthoryAgreement),this._i(this._c("businessObj",this.businessObj),(function(e,t){this._c("nativePage",this.nativePage),e.protocolUrl,e.name}))),this._c("bindState",this.bindState),this._c("confirmMask",this.confirmMask),this._r()}};o("./src/components/newUserReg/index.js?packageName=main&resourcePath=%2FUsers%2Ffwind%2Fgome%2Fgitlab%2Fgome-mini%2Fpackages%2Flogin%2Fsrc%2Fcomponents%2FnewUserReg%2Findex.mpx");e.currentModuleId}.call(this,o("../../node_modules/webpack/buildin/global.js"))}},[["./src/components/newUserReg/index.mpx?packageName=main","bundle"]]]);
export default global['__wxComponents']['gome-login/components/index427e302c/index']
</script>
<style platform="mp-weixin">
.authory-container{width:100%}.authory-container,page{height:100%;background-color:#fff}page{box-sizing:border-box;color:#333;font-family:PingFangSC-Regular}button:after{border:none}.authory-phone-wrapper{margin-top:180rpx;padding:0 80rpx;padding: 0 80rpx;}.avatar{display:block;width:150rpx;height:150rpx;border-radius:50%;margin:0 auto 20rpx}.nickname{text-align:center;font-size:30rpx;line-height:50rpx;font-family:PingFangSC-Medium}.use-phone-bind{width:100%;height:88rpx;line-height:88rpx;font-size:28rpx;color:#666;text-align:center;background:#fff;border-radius:55rpx;margin:30rpx auto 0;border:1px solid #ccc}.use-phone-bind .icon{width:30rpx;height:34rpx;vertical-align:middle;margin-right:20rpx}.login-wrapper .authory-phone-button{margin-top:30rpx}.authory-phone-wrapper .authory-phone-button{margin-top:130rpx}.authory-phone-wrapper .authory-phone-button.authory-btn--hover{opacity:.7}.placeholder-s{color:#ccc;font-family:STHeitiSC-Light;font-size:29rpx;color:#bfbfbf}.login-wrapper{padding:0 80rpx;margin-top: 200rpx;}.login-wrapper .logo{display:block;width:272rpx;height:154rpx;margin:67rpx auto 41rpx}.login-wrapper .verify-boxs{margin-bottom:34rpx}.login-wrapper .verify-list{display:-webkit-box;display:-webkit-flex;display:flex;box-sizing:border-box;width:100%}.login-wrapper .input-box{position:relative;-webkit-box-flex:1;-webkit-flex:auto;flex:auto;box-sizing:border-box;border-bottom:1rpx solid #ddd;padding:10rpx 30rpx 22rpx 62rpx}.login-wrapper .input-box .image-icon{position:absolute;left:12rpx;top:10rpx;width:30rpx;height:34rpx}.login-wrapper .input-box .input{display:block;height:34rpx;font-size:28rpx;line-height:34rpx;min-height:34rpx}.login-wrapper .input-box .clear{position:absolute;right:0;top:13rpx;width:40rpx;height:40rpx;display:none}.login-wrapper .input-box .show{display:block}.login-wrapper .code{width:220rpx;-webkit-flex:0 0 200rpx;flex:0 0 200rpx;height:64rpx;line-height:60rpx;margin-left:20rpx;box-sizing:border-box;border:1rpx solid var(--font-color);border-radius:100rpx;font-size:28rpx;white-space:nowrap;color:var(--font-color);background-color:#fff}.login-wrapper .code[disabled]:not([type]){color:#bfbfbf;background-color:#fff;border-color:#d8d8d8}.login-wrapper .code-not{width:220rpx;-webkit-flex:0 0 200rpx;flex:0 0 200rpx;height:64rpx;line-height:60rpx;margin-left:20rpx;box-sizing:border-box;border:1rpx solid var(--font-color);border-radius:100rpx;border-color:#d8d8d8;font-size:28rpx;white-space:nowrap;background-color:#fff;color:#bfbfbf}.login-wrapper .code.style-module_disabled__23RIG{color:#bfbfbf;background-color:#fff;border-color:#d8d8d8}.login-wrapper .error{font-size:24rpx;color:#ff5c5c;line-height:40rpx;padding:20rpx 12rpx 0}.confirm{width:100%;height:88rpx;margin-top:58rpx;line-height:88rpx;font-size:32rpx;color:#fff;text-align:center;background-image:linear-gradient(90deg,var(--left),var(--right));background-color:var(--background-color);border-radius:55rpx}.confirm-not,.confirm[disabled]:not([type]){height:88rpx;color:#fff;opacity:.3;background-color:var(--background-color)}.confirm-not{width:100%;margin-top:58rpx;line-height:88rpx;font-size:32rpx;text-align:center;background-image:linear-gradient(90deg,var(--left),var(--right));border-radius:55rpx}.confirm.style-module_disabled__23RIG{height:88rpx;color:#fff;opacity:.3;background-color:var(--background-color)}.authory-phone-button{height:88rpx;line-height:88rpx;font-size:30rpx;color:#fff;width:100%;text-align:center}.authory-phone-button .img{width:40rpx;height:40rpx;vertical-align:middle;margin-right:20rpx}.agreement-box{margin-top:26rpx;font-size:26rpx;color:#999;line-height:42rpx;padding-left:58rpx;position:absolute;bottom:30rpx;left:80rpx}.agreement-box .checkbox{position:absolute;left:0;top:2rpx}.navStyle{display:inline-block;color:#78bee9}.mask{background:transparent}.bind-mask,.mask{position:fixed;left:0;top:0;right:0;bottom:0;z-index:10000;width:100%}.bind-mask{background:rgba(0,0,0,.6)}.bind-box{position:fixed;z-index:2;width:690rpx;padding:20rpx 30rpx;left:0;bottom:90rpx;background:#fff;display:flex;flex-direction:column}.bind-tit{display:flex;justify-content:space-between;align-items:center;padding:20rpx 0;line-height:40rpx;font-size:32rpx;color:#00050a}.bind-tit>.img{width:30rpx;height:30rpx;margin-right:20rpx}.layer-h2{padding:20rpx 0;line-height:40rpx;font-size:28rpx;color:#00050a}.bind-btn{position:fixed;z-index:2;width:750rpx;height:90rpx;left:0;bottom:0;background:#fff;display:flex;align-items:center;text-align:center;font-size:32rpx}.change-phone{background:#ccc}.bind-phone,.change-phone{width:50%;line-height:90rpx;color:#fff}.bind-phone{background:var(--background-color);text-align:center}
</style>
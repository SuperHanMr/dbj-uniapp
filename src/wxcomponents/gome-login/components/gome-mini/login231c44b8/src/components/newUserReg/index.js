var window=window||{};window.webpackJsonp=require("../../../../../../bundle.js"),module.exports=(window.webpackJsonp=window.webpackJsonp||[]).push([["components/gome-mini/login231c44b8/src/components/newUserReg/index"],{"../../node_modules/@mpxjs/webpack-plugin/lib/native-loader.js!./src/components/newUserReg/index.js?packageName=main":function(e,t,o){"use strict";o.r(t),function(e){e.currentModuleId="m33441a08",e.currentCtor=Component,e.currentCtorType="component",e.currentSrcMode="wx";o("./src/components/newUserReg/index.js?packageName=main&resourcePath=%2FUsers%2Ffwind%2Fgome%2Fgitlab%2Fgome-mini%2Fpackages%2Flogin%2Fsrc%2Fcomponents%2FnewUserReg%2Findex.js");e.currentModuleId}.call(this,o("../../node_modules/webpack/buildin/global.js"))},"./src/components/newUserReg/index.js?packageName=main&resourcePath=%2FUsers%2Ffwind%2Fgome%2Fgitlab%2Fgome-mini%2Fpackages%2Flogin%2Fsrc%2Fcomponents%2FnewUserReg%2Findex.js":function(e,t,o){"use strict";var s=o("./src/utils/apis.js"),n=o("./src/utils/regular.js"),a=o("./src/utils/index.js");Component({properties:{loginData:{type:Object,value:{}}},data:{isShowAuthoryPhone:!0,showPhoneError:!0,codeIsClick:!0,codeError:"",countdownTemp:120,confirmIsClick:!0,confirmMask:!0,relationCode:"",relationNewUserCode:1001,passwordError:"",phone:"",code:"",password:"",phoneClear:!1,codeClear:!1,phoneFocus:!1,passwordClear:!1,codeTxt:"获取验证码",isSelectAuthoryAgreement:!0,loginCode:"",avatarUrl:"",nickName:"",isWechatBindStatus:!1,bindState:!1,platForm:"",isShowFooter:!0,themeStyle:"--left:#FF5FD2;--right:#B20FD3;--font-color:#B20FD3;",checkboxThemeColor:"#B20FD3"},lifetimes:{attached(){const{avatarUrl:e,avatar:t,nickName:o}=Object(a.b)("userInfo"),{appId:s,ctx:n,sharerUnionId:i,sharerUserId:r,platForm:c,distinctId:d,whereFromStr:h,themeConfig:l}=this.data.loginData;if(this.setData({avatarUrl:e||t,nickName:o,appId:s,ctx:n,sharerUnionId:i,sharerUserId:r,platForm:c,distinctId:d,whereFromStr:h}),l){const{backgroundColor:e,fontColor:t}=l;let o="";e&&(o+=`--background-color:${e};`,this.setData({checkboxThemeColor:e})),t&&(o+=`--font-color:${t};`),this.setData({themeStyle:o})}this.authoryLogin(),this.getUserAgreement()}},methods:{getUserAgreement:function(){const e=this,{appId:t,ctx:o}=this.data,n={appId:t,useType:"0"};s.a.getAppletProtocolInfoList(n,o,{success(t){const{code:o,businessObj:s,message:n}=t.data;0===o?e.setData({businessObj:s}):wx.showToast({title:n||"系统忙，请稍后再试",icon:"none",mask:!0})}})},bindPhoneInput:function(e){const t=e.detail.value,o=t.length;let s=!0;11==o&&(s=!1),this.setData({codeIsClick:s,phone:t,codeError:!1,phoneClear:!!o}),this.dealConfirmIsClick()},bindPhoneFocus:function(e){const t=e.detail.value;this.setData({showPhoneError:!0,phoneClear:!!t,isShowFooter:!1})},bindPhoneBlur:function(){this.setData({phoneClear:!1,codeError:!1,isShowFooter:!0})},bindClearPhone:function(){this.setData({phone:"",phoneClear:!1,codeIsClick:!0}),this.dealConfirmIsClick(),Object(a.c)()},bindCodeInput:function(e){const t=e.detail.value,o=t.length;this.setData({code:t,codeClear:!!o}),this.dealConfirmIsClick()},bindCodeFocus:function(e){const t=e.detail.value;this.setData({codeError:"",codeClear:!!t,isShowFooter:!1})},bindCodeBlur:function(){this.setData({codeClear:!1,isShowFooter:!0})},bindClearCode:function(){this.setData({code:"",codeClear:!1}),this.dealConfirmIsClick(),Object(a.c)()},bindGetCode:function(){const{phone:e}=this.data;Object(n.b)(e)?this.setData({showPhoneError:!1}):this.dealAuthoryCode()},bindPasswordFocus:function(e){const t=e.detail.value;this.setData({passwordError:"",passwordClear:!!t,isShowFooter:!1})},bindPasswordInput:function(e){const t=e.detail.value,o=t.length;this.setData({password:t,passwordClear:!!o}),this.dealConfirmIsClick()},bindPasswordBlur:function(){this.checkPasswordHandler(),this.setData({passwordClear:!1,isShowFooter:!0})},bindClearPassword:function(){this.setData({password:"",passwordClear:!1}),this.dealConfirmIsClick(),Object(a.c)()},bindAuthoryRadioChange:function(e){const t=e.detail.value.join("");this.setData({isSelectAuthoryAgreement:!!t})},bindConfirm:function(){this.dealCompleteRelation()},dealCompleteRelation:function(e){const t=this,{appId:o,distinctId:i,relationCode:r,relationNewUserCode:c,password:d,code:h,isSelectAuthoryAgreement:l,sharerUserId:u,sharerUnionId:p,ctx:m,whereFromStr:w}=this.data,g=e||this.data.phone,C=Object(a.b)("setUnionId");let f=0;const b=Object(a.b)("userInfo"),F={appId:o,phoneNum:g,snsUserId:C,isWechatBind:e?1:0,puserId:u,puniqueId:p,headimg:b.avatarUrl?null!=b.avatarUrl?b.avatarUrl:"":b.avatar?b.avatar:"",snsUserName:null!=b.nickName?b.nickName:""};if(w&&(F.whereFrom=w),i&&(F.distinctId=i),!l)return wx.showModal({title:"提示",content:"请您确认勾选绑定手机号协议",cancelText:"取消",confirmText:"确定"}),!1;if(!e&&(F.msgCode=h,Object(n.b)(g)))return this.setData({showPhoneError:!1}),!1;if(r==c)if(f=1,F.pwd=d,e)F.pwd="SNS_GOME_PWD";else if(this.checkPasswordHandler())return!1;e||this.setData({confirmMask:!1}),s.a.checkPassword(F,f,m,{success(o){const{code:s,message:n,extParams:a}=o.data;e||t.setData({confirmMask:!0}),t.triggerEvent("onRelation",{code:s,message:n,extParams:a,phone:t.data.phone})},catch(o){e||t.setData({confirmMask:!0})}})},switchDiffAuthory:function(){this.setData({isShowAuthoryPhone:!1,bindState:!1,phone:"",phoneClear:!1})},onGetAuthorize:function(e){let t=this;const{isSelectAuthoryAgreement:o}=this.data;o?my.getPhoneNumber({success:e=>{const o=JSON.parse(e.response),{response:s,sign:n}=o,a={encryptedData:s,signature:n};t.getPhoneNumberForWeApp(a)},fail:e=>{}}):wx.showModal({title:"提示",content:"请您确认勾选绑定手机号协议",cancelText:"取消",confirmText:"确定"})},getPhoneNumber:function(e){const t=this,{encryptedData:o,iv:s,errMsg:n}=e.detail;if("getPhoneNumber:ok"==n){const e={encryptedData:o,iv:s};wx.checkSession({success(o){t.getPhoneNumberForWeApp(e)},fail(){t.authoryLogin((()=>{t.getPhoneNumberForWeApp(e)}))}})}else"getPhoneNumber:fail platform auth deny"==n?this.setData({isShowAuthoryPhone:!1}):(this.authoryLogin(),n.includes("auth deny")||wx.showToast({title:"请授权允许获取手机号后重试！",icon:"none",duration:2e3}))},getPhoneNumberForWeApp:function(e){const t=this,{loginCode:o,appId:n,ctx:a,whereFromStr:i}=this.data;e.code=o,e.appId=n,i&&(e.whereFromStr=i),s.a.getPhoneNumber(e,a,{success(e){const{code:o,phoneNumber:s,message:n}=e.data;if(t.authoryLogin(),200==o){const e=s;t.setData({phone:e,isWechatBindStatus:!0}),t.dealAuthoryCode(1,0)}else t.setData({isWechatBindStatus:!1}),wx.showToast({title:n||"系统忙，请稍后再试",icon:"none",mask:!0,duration:2e3})}})},authoryLogin(e){const t=this,{platForm:o}=this.data;wx["swan"===o?"getLoginCode":"login"]({success(o){o.code&&(t.setData({loginCode:o.code}),e&&e())}})},dealAuthoryCode:function(e="",t=""){const o=this,{appId:n,phone:i,platForm:r,ctx:c,whereFromStr:d}=this.data,h=Object(a.b)("setUnionId"),l={appId:n,phoneNum:i,snsUserId:h,isWechatBind:e,isChangeBind:"wx"==r?t:""};d&&(l.whereFrom=d),s.a.getRelationPhoneCode(l,c,{success(e){const{data:s}=e,{code:n}=s;o.setData({relationCode:n}),o.triggerEvent("onPhoneCode",{code:n,data:s,isChangeBind:t,phone:i})}})},dealCountdown:function(){let{countdownTemp:e}=this.data;e>1?(this.data.countdownTemp--,this.setData({codeIsClick:!0,codeTxt:`${e}s`}),setTimeout((()=>{this.dealCountdown()}),1e3)):this.setData({codeIsClick:!1,countdownTemp:120,codeTxt:"重新获取"})},dealConfirmIsClick:function(){const{phone:e,code:t,password:o,relationCode:s,isSelectAuthoryAgreement:a,relationNewUserCode:i}=this.data,r=!Object(n.d)(t);let c=!0;11!=e.length||r||(c=!1),c||(c=2e3!=s&&s!=i,s==i&&(c=o.length<6)),this.setData({confirmIsClick:c})},checkPasswordHandler(){const{password:e}=this.data,{error:t,status:o}=Object(n.a)(e);return o&&this.setData({passwordError:t}),o},closeLayer:function(){this.setData({bindState:!1})},bindPhoneEvent:function(){const{isWechatBindStatus:e}=this.data;this.setData({bindState:!1}),e?this.dealAuthoryCode(1,1):this.dealAuthoryCode(0,1)},tipsShowModal(e){let t=this;wx.showModal({title:"提示",content:e,cancelText:"更换号码",confirmText:"联系客服",confirmColor:"#F66A6B",success:function(e){e.confirm?wx.showModal({content:"400-811-3333"}):e.cancel&&t.setData({phone:"",code:"",isShowAuthoryPhone:!1,phoneClear:!1,codeClear:!1,codeIsClick:!1,codeTxt:"获取验证码",countdownTemp:120,phoneFocus:!0})}})}}})}},[["../../node_modules/@mpxjs/webpack-plugin/lib/native-loader.js!./src/components/newUserReg/index.js?packageName=main","bundle"]]]);
<template>
<uni-shadow-root class="gome-login-components-gome-mini-login231c44b8-src-components-newUserReg-index"><view class="authory-container" :style="themeStyle"><view class="authory-phone-wrapper" v-if="isShowAuthoryPhone"><image class="avatar" mode="aspectFit" :src="avatarUrl"></image> <view class="nickname">{{nickName}}</view>   <button class="authory-phone-button confirm" :disabled="(!isSelectAuthoryAgreement)" hover-class="authory-btn--hover" open-type="getPhoneNumber" @getphonenumber="getPhoneNumber"><image src="/img/weixin.c10fa53e.png" v-if="platForm === 'wx'"></image>授权手机号一键绑定</button> <view class="use-phone-bind" @click="switchDiffAuthory">使用其他手机号</view></view> <view class="login-wrapper" v-else><image class="logo" mode="aspectFit" src="/img/logo.0ccb88de.png"></image> <view><view class="verify-boxs"><view class="verify-list input-phone"><view class="input-box"><image class="image-icon" src="/img/phone-icon.5d716ece.png"></image> <input placeholder-style="font-size: 29rpx;color: #bfbfbf;" placeholder="请输入手机号" type="number" maxlength="11" @input="bindPhoneInput" @focus="bindPhoneFocus" @blur="bindPhoneBlur" :focus="phoneFocus" :value="phone"></input> <image :class="'clear '+(phoneClear ? 'show' : '')" src="/img/close-icon.fc45a809.png" @click="bindClearPhone"></image></view></view></view> <view class="error" :hidden="showPhoneError">请输入正确的手机号</view> <view class="verify-boxs"><view class="verify-list"><view class="input-box"><image class="image-icon" src="/img/key-icon.0f5d0462.png"></image> <input placeholder-style="font-size: 29rpx;color: #bfbfbf;" placeholder="请输入验证码" type="number" @input="bindCodeInput" @focus="bindCodeFocus" @blur="bindCodeBlur" :value="code"></input> <image :class="'clear '+(codeClear ? 'show' : '')" src="/img/close-icon.fc45a809.png" @click="bindClearCode"></image></view> <button :disabled="codeIsClick" class="code" @click="bindGetCode">{{codeTxt}}</button></view> <view :hidden="(!codeError)" class="error">{{codeError}}</view></view> <view class="verify-boxs" :hidden="relationCode == relationNewUserCode ? false : true"><view class="verify-list"><view class="input-box"><image class="image-icon" src="/img/lock.b8cb9367.png"></image>  <input placeholder-style="font-size: 28rpx;color: #bfbfbf;" placeholder="请设置密码，6-20位数字、字母或字符" type="password" minlength="6" maxlength="20" @input="bindPasswordInput" @blur="bindPasswordBlur" @focus="bindPasswordFocus" :value="password"></input> <image :class="'clear '+(passwordClear ? 'show' : '')" src="/img/close-icon.fc45a809.png" @click="bindClearPassword"></image></view></view></view> <view class="error" :hidden="(!passwordError)">{{passwordError}}</view></view> <button class="confirm" :disabled="(!isSelectAuthoryAgreement || confirmIsClick)" @click="bindConfirm">完成</button>   <button class="authory-phone-button confirm" :disabled="(!isSelectAuthoryAgreement)" open-type="getPhoneNumber" @getphonenumber="getPhoneNumber"><image src="/img/weixin.c10fa53e.png" v-if="platForm === 'wx'"></image>授权手机号一键绑定</button></view> <view class="agreement-box" v-if="isShowFooter"><checkbox-group class="radio-group" @change="bindAuthoryRadioChange"><label><checkbox value="1" :color="checkboxThemeColor" :checked="isSelectAuthoryAgreement"></checkbox>绑定手机号即代表您同意</label></checkbox-group> <block v-for="(business,index) in (businessObj)" :key="business.index"><navigator class="navStyle" :url="'/pages/active/active?url='+(business.protocolUrl)">{{business.name}}</navigator></block></view> <view class="bind-mask" v-if="bindState"><view class="bind-box"><view class="bind-tit"><view>更换绑定第三方平台账号须知</view> <image @click="closeLayer" src="/img/close.5bdc4fee.png"></image></view> <view class="layer-h2"><view>变更绑定同一第三方平台账号须知如下：</view> <view>1）变更后您的资产不发生任何变化。</view> <view>2）变更绑定同一第三方平台内账号的30天内无法进行二次解绑。</view> <view>请您知悉。</view></view></view> <view class="bind-btn"><view class="change-phone" @click="switchDiffAuthory">更换手机号</view> <view class="bind-phone" @click="bindPhoneEvent">继续绑定</view></view></view> <view class="mask" :hidden="confirmMask"></view></view></uni-shadow-root>
</template>

<script>

global['__wxRoute'] = 'gome-login/components/gome-mini/login231c44b8/src/components/newUserReg/index'
var window=window||{};window.webpackJsonp=require("../../../../../../bundle.js"),module.exports=(window.webpackJsonp=window.webpackJsonp||[]).push([["components/gome-mini/login231c44b8/src/components/newUserReg/index"],{"../../node_modules/@mpxjs/webpack-plugin/lib/native-loader.js!./src/components/newUserReg/index.js?packageName=main":function(e,t,o){"use strict";o.r(t),function(e){e.currentModuleId="m33441a08",e.currentCtor=Component,e.currentCtorType="component",e.currentSrcMode="wx";o("./src/components/newUserReg/index.js?packageName=main&resourcePath=%2FUsers%2Ffwind%2Fgome%2Fgitlab%2Fgome-mini%2Fpackages%2Flogin%2Fsrc%2Fcomponents%2FnewUserReg%2Findex.js");e.currentModuleId}.call(this,o("../../node_modules/webpack/buildin/global.js"))},"./src/components/newUserReg/index.js?packageName=main&resourcePath=%2FUsers%2Ffwind%2Fgome%2Fgitlab%2Fgome-mini%2Fpackages%2Flogin%2Fsrc%2Fcomponents%2FnewUserReg%2Findex.js":function(e,t,o){"use strict";var s=o("./src/utils/apis.js"),n=o("./src/utils/regular.js"),a=o("./src/utils/index.js");Component({properties:{loginData:{type:Object,value:{}}},data:{isShowAuthoryPhone:!0,showPhoneError:!0,codeIsClick:!0,codeError:"",countdownTemp:120,confirmIsClick:!0,confirmMask:!0,relationCode:"",relationNewUserCode:1001,passwordError:"",phone:"",code:"",password:"",phoneClear:!1,codeClear:!1,phoneFocus:!1,passwordClear:!1,codeTxt:"获取验证码",isSelectAuthoryAgreement:!0,loginCode:"",avatarUrl:"",nickName:"",isWechatBindStatus:!1,bindState:!1,platForm:"",isShowFooter:!0,themeStyle:"--left:#FF5FD2;--right:#B20FD3;--font-color:#B20FD3;",checkboxThemeColor:"#B20FD3"},lifetimes:{attached(){const{avatarUrl:e,avatar:t,nickName:o}=Object(a.b)("userInfo"),{appId:s,ctx:n,sharerUnionId:i,sharerUserId:r,platForm:c,distinctId:d,whereFromStr:h,themeConfig:l}=this.data.loginData;if(this.setData({avatarUrl:e||t,nickName:o,appId:s,ctx:n,sharerUnionId:i,sharerUserId:r,platForm:c,distinctId:d,whereFromStr:h}),l){const{backgroundColor:e,fontColor:t}=l;let o="";e&&(o+=`--background-color:${e};`,this.setData({checkboxThemeColor:e})),t&&(o+=`--font-color:${t};`),this.setData({themeStyle:o})}this.authoryLogin(),this.getUserAgreement()}},methods:{getUserAgreement:function(){const e=this,{appId:t,ctx:o}=this.data,n={appId:t,useType:"0"};s.a.getAppletProtocolInfoList(n,o,{success(t){const{code:o,businessObj:s,message:n}=t.data;0===o?e.setData({businessObj:s}):wx.showToast({title:n||"系统忙，请稍后再试",icon:"none",mask:!0})}})},bindPhoneInput:function(e){const t=e.detail.value,o=t.length;let s=!0;11==o&&(s=!1),this.setData({codeIsClick:s,phone:t,codeError:!1,phoneClear:!!o}),this.dealConfirmIsClick()},bindPhoneFocus:function(e){const t=e.detail.value;this.setData({showPhoneError:!0,phoneClear:!!t,isShowFooter:!1})},bindPhoneBlur:function(){this.setData({phoneClear:!1,codeError:!1,isShowFooter:!0})},bindClearPhone:function(){this.setData({phone:"",phoneClear:!1,codeIsClick:!0}),this.dealConfirmIsClick(),Object(a.c)()},bindCodeInput:function(e){const t=e.detail.value,o=t.length;this.setData({code:t,codeClear:!!o}),this.dealConfirmIsClick()},bindCodeFocus:function(e){const t=e.detail.value;this.setData({codeError:"",codeClear:!!t,isShowFooter:!1})},bindCodeBlur:function(){this.setData({codeClear:!1,isShowFooter:!0})},bindClearCode:function(){this.setData({code:"",codeClear:!1}),this.dealConfirmIsClick(),Object(a.c)()},bindGetCode:function(){const{phone:e}=this.data;Object(n.b)(e)?this.setData({showPhoneError:!1}):this.dealAuthoryCode()},bindPasswordFocus:function(e){const t=e.detail.value;this.setData({passwordError:"",passwordClear:!!t,isShowFooter:!1})},bindPasswordInput:function(e){const t=e.detail.value,o=t.length;this.setData({password:t,passwordClear:!!o}),this.dealConfirmIsClick()},bindPasswordBlur:function(){this.checkPasswordHandler(),this.setData({passwordClear:!1,isShowFooter:!0})},bindClearPassword:function(){this.setData({password:"",passwordClear:!1}),this.dealConfirmIsClick(),Object(a.c)()},bindAuthoryRadioChange:function(e){const t=e.detail.value.join("");this.setData({isSelectAuthoryAgreement:!!t})},bindConfirm:function(){this.dealCompleteRelation()},dealCompleteRelation:function(e){const t=this,{appId:o,distinctId:i,relationCode:r,relationNewUserCode:c,password:d,code:h,isSelectAuthoryAgreement:l,sharerUserId:u,sharerUnionId:p,ctx:m,whereFromStr:w}=this.data,g=e||this.data.phone,C=Object(a.b)("setUnionId");let f=0;const b=Object(a.b)("userInfo"),F={appId:o,phoneNum:g,snsUserId:C,isWechatBind:e?1:0,puserId:u,puniqueId:p,headimg:b.avatarUrl?null!=b.avatarUrl?b.avatarUrl:"":b.avatar?b.avatar:"",snsUserName:null!=b.nickName?b.nickName:""};if(w&&(F.whereFrom=w),i&&(F.distinctId=i),!l)return wx.showModal({title:"提示",content:"请您确认勾选绑定手机号协议",cancelText:"取消",confirmText:"确定"}),!1;if(!e&&(F.msgCode=h,Object(n.b)(g)))return this.setData({showPhoneError:!1}),!1;if(r==c)if(f=1,F.pwd=d,e)F.pwd="SNS_GOME_PWD";else if(this.checkPasswordHandler())return!1;e||this.setData({confirmMask:!1}),s.a.checkPassword(F,f,m,{success(o){const{code:s,message:n,extParams:a}=o.data;e||t.setData({confirmMask:!0}),t.triggerEvent("onRelation",{code:s,message:n,extParams:a,phone:t.data.phone})},catch(o){e||t.setData({confirmMask:!0})}})},switchDiffAuthory:function(){this.setData({isShowAuthoryPhone:!1,bindState:!1,phone:"",phoneClear:!1})},onGetAuthorize:function(e){let t=this;const{isSelectAuthoryAgreement:o}=this.data;o?my.getPhoneNumber({success:e=>{const o=JSON.parse(e.response),{response:s,sign:n}=o,a={encryptedData:s,signature:n};t.getPhoneNumberForWeApp(a)},fail:e=>{}}):wx.showModal({title:"提示",content:"请您确认勾选绑定手机号协议",cancelText:"取消",confirmText:"确定"})},getPhoneNumber:function(e){const t=this,{encryptedData:o,iv:s,errMsg:n}=e.detail;if("getPhoneNumber:ok"==n){const e={encryptedData:o,iv:s};wx.checkSession({success(o){t.getPhoneNumberForWeApp(e)},fail(){t.authoryLogin((()=>{t.getPhoneNumberForWeApp(e)}))}})}else"getPhoneNumber:fail platform auth deny"==n?this.setData({isShowAuthoryPhone:!1}):(this.authoryLogin(),n.includes("auth deny")||wx.showToast({title:"请授权允许获取手机号后重试！",icon:"none",duration:2e3}))},getPhoneNumberForWeApp:function(e){const t=this,{loginCode:o,appId:n,ctx:a,whereFromStr:i}=this.data;e.code=o,e.appId=n,i&&(e.whereFromStr=i),s.a.getPhoneNumber(e,a,{success(e){const{code:o,phoneNumber:s,message:n}=e.data;if(t.authoryLogin(),200==o){const e=s;t.setData({phone:e,isWechatBindStatus:!0}),t.dealAuthoryCode(1,0)}else t.setData({isWechatBindStatus:!1}),wx.showToast({title:n||"系统忙，请稍后再试",icon:"none",mask:!0,duration:2e3})}})},authoryLogin(e){const t=this,{platForm:o}=this.data;wx["swan"===o?"getLoginCode":"login"]({success(o){o.code&&(t.setData({loginCode:o.code}),e&&e())}})},dealAuthoryCode:function(e="",t=""){const o=this,{appId:n,phone:i,platForm:r,ctx:c,whereFromStr:d}=this.data,h=Object(a.b)("setUnionId"),l={appId:n,phoneNum:i,snsUserId:h,isWechatBind:e,isChangeBind:"wx"==r?t:""};d&&(l.whereFrom=d),s.a.getRelationPhoneCode(l,c,{success(e){const{data:s}=e,{code:n}=s;o.setData({relationCode:n}),o.triggerEvent("onPhoneCode",{code:n,data:s,isChangeBind:t,phone:i})}})},dealCountdown:function(){let{countdownTemp:e}=this.data;e>1?(this.data.countdownTemp--,this.setData({codeIsClick:!0,codeTxt:`${e}s`}),setTimeout((()=>{this.dealCountdown()}),1e3)):this.setData({codeIsClick:!1,countdownTemp:120,codeTxt:"重新获取"})},dealConfirmIsClick:function(){const{phone:e,code:t,password:o,relationCode:s,isSelectAuthoryAgreement:a,relationNewUserCode:i}=this.data,r=!Object(n.d)(t);let c=!0;11!=e.length||r||(c=!1),c||(c=2e3!=s&&s!=i,s==i&&(c=o.length<6)),this.setData({confirmIsClick:c})},checkPasswordHandler(){const{password:e}=this.data,{error:t,status:o}=Object(n.a)(e);return o&&this.setData({passwordError:t}),o},closeLayer:function(){this.setData({bindState:!1})},bindPhoneEvent:function(){const{isWechatBindStatus:e}=this.data;this.setData({bindState:!1}),e?this.dealAuthoryCode(1,1):this.dealAuthoryCode(0,1)},tipsShowModal(e){let t=this;wx.showModal({title:"提示",content:e,cancelText:"更换号码",confirmText:"联系客服",confirmColor:"#F66A6B",success:function(e){e.confirm?wx.showModal({content:"400-811-3333"}):e.cancel&&t.setData({phone:"",code:"",isShowAuthoryPhone:!1,phoneClear:!1,codeClear:!1,codeIsClick:!1,codeTxt:"获取验证码",countdownTemp:120,phoneFocus:!0})}})}}})}},[["../../node_modules/@mpxjs/webpack-plugin/lib/native-loader.js!./src/components/newUserReg/index.js?packageName=main","bundle"]]]);
export default global['__wxComponents']['gome-login/components/gome-mini/login231c44b8/src/components/newUserReg/index']
</script>
<style platform="mp-weixin">
.authory-container{width:100%}.authory-container,page{height:100%;background-color:#fff}page{box-sizing:border-box;color:#333;font-family:PingFangSC-Regular}button:after{border:none}.authory-phone-wrapper{margin-top:80rpx;padding:0 80rpx}.avatar{display:block;width:150rpx;height:150rpx;border-radius:50%;margin:0 auto 20rpx}.nickname{text-align:center;font-size:30rpx;line-height:50rpx;font-family:PingFangSC-Medium}.use-phone-bind{width:100%;height:88rpx;line-height:88rpx;font-size:28rpx;color:#666;text-align:center;background:#fff;border-radius:55rpx;margin:30rpx auto 0;border:1px solid #ccc}.use-phone-bind .icon{width:30rpx;height:34rpx;vertical-align:middle;margin-right:20rpx}.login-wrapper .authory-phone-button{margin-top:30rpx}.authory-phone-wrapper .authory-phone-button{margin-top:130rpx}.authory-phone-wrapper .authory-phone-button.authory-btn--hover{opacity:.7}.placeholder-s{color:#ccc;font-family:STHeitiSC-Light;font-size:29rpx;color:#bfbfbf}.login-wrapper{padding:0 80rpx}.login-wrapper .logo{display:block;width:194rpx;height:91rpx;margin:67rpx auto 41rpx}.login-wrapper .verify-boxs{margin-bottom:34rpx}.login-wrapper .verify-list{display:-webkit-box;display:-webkit-flex;display:flex;box-sizing:border-box;width:100%}.login-wrapper .input-box{position:relative;-webkit-box-flex:1;-webkit-flex:auto;flex:auto;box-sizing:border-box;border-bottom:1rpx solid #ddd;padding:10rpx 30rpx 22rpx 62rpx}.login-wrapper .input-box .image-icon{position:absolute;left:12rpx;top:10rpx;width:30rpx;height:34rpx}.login-wrapper .input-box input{display:block;height:34rpx;font-size:28rpx;line-height:34rpx;min-height:34rpx}.login-wrapper .input-box .clear{position:absolute;right:0;top:13rpx;width:40rpx;height:40rpx;display:none}.login-wrapper .input-box .show{display:block}.login-wrapper .code{width:220rpx;-webkit-flex:0 0 200rpx;flex:0 0 200rpx;height:64rpx;line-height:60rpx;margin-left:20rpx;box-sizing:border-box;border:1rpx solid var(--font-color);border-radius:100rpx;font-size:28rpx;white-space:nowrap;color:var(--font-color);background-color:#fff}.login-wrapper .code.style-module_disabled__23RIG,.login-wrapper .code[disabled]:not([type]){color:#bfbfbf;background-color:#fff;border-color:#d8d8d8}.login-wrapper .error{font-size:24rpx;color:#ff5c5c;line-height:40rpx;padding:20rpx 12rpx 0}.confirm{width:100%;height:88rpx;margin-top:58rpx;line-height:88rpx;font-size:32rpx;color:#fff;text-align:center;background-image:linear-gradient(90deg,var(--left),var(--right));background-color:var(--background-color);border-radius:55rpx}.confirm.style-module_disabled__23RIG,.confirm[disabled]:not([type]){height:88rpx;color:#fff;opacity:.3;background-color:var(--background-color)}.authory-phone-button{height:88rpx;line-height:88rpx;font-size:30rpx;color:#fff;width:100%;text-align:center}.authory-phone-button image{width:40rpx;height:40rpx;vertical-align:middle;margin-right:20rpx}.agreement-box{margin-top:26rpx;font-size:26rpx;color:#999;line-height:42rpx;padding-left:58rpx;position:absolute;bottom:30rpx;left:80rpx}.agreement-box checkbox{position:absolute;left:0;top:2rpx}.navStyle{display:inline-block;color:#78bee9}.mask{background:transparent}.bind-mask,.mask{position:fixed;left:0;top:0;right:0;bottom:0;z-index:10000;width:100%}.bind-mask{background:rgba(0,0,0,.6)}.bind-box{position:fixed;z-index:2;width:690rpx;padding:20rpx 30rpx;left:0;bottom:90rpx;background:#fff;display:flex;flex-direction:column}.bind-tit{display:flex;justify-content:space-between;align-items:center;padding:20rpx 0;line-height:40rpx;font-size:32rpx;color:#00050a}.bind-tit>image{width:30rpx;height:30rpx;margin-right:20rpx}.layer-h2{padding:20rpx 0;line-height:40rpx;font-size:28rpx;color:#00050a}.bind-btn{position:fixed;z-index:2;width:750rpx;height:90rpx;left:0;bottom:0;background:#fff;display:flex;align-items:center;text-align:center;font-size:32rpx}.change-phone{background:#ccc}.bind-phone,.change-phone{width:50%;line-height:90rpx;color:#fff}.bind-phone{background:var(--background-color);text-align:center}
</style>
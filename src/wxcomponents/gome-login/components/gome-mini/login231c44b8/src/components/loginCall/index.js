var window=window||{};window.webpackJsonp=require("../../../../../../bundle.js"),module.exports=(window.webpackJsonp=window.webpackJsonp||[]).push([["components/gome-mini/login231c44b8/src/components/loginCall/index"],{"../../node_modules/@mpxjs/webpack-plugin/lib/native-loader.js!./src/components/loginCall/index.js?packageName=main":function(e,t,s){"use strict";s.r(t),function(e){e.currentModuleId="m40ea44b4",e.currentCtor=Component,e.currentCtorType="component",e.currentSrcMode="wx";s("./src/components/loginCall/index.js?packageName=main&resourcePath=%2FUsers%2Ffwind%2Fgome%2Fgitlab%2Fgome-mini%2Fpackages%2Flogin%2Fsrc%2Fcomponents%2FloginCall%2Findex.js");e.currentModuleId}.call(this,s("../../node_modules/webpack/buildin/global.js"))},"./src/components/loginCall/index.js?packageName=main&resourcePath=%2FUsers%2Ffwind%2Fgome%2Fgitlab%2Fgome-mini%2Fpackages%2Flogin%2Fsrc%2Fcomponents%2FloginCall%2Findex.js":function(e,t,s){"use strict";var a=s("./src/utils/apis.js"),n=s("./src/utils/index.js");Component({btnDisabled:!1,properties:{loginData:{type:null,value:{}}},data:{imgUrl:"",imgWidth:0,imgHeight:0,height:"",cancelName:"短信验证码登录",loginList:{},canIUseGetUserProfile:!1,appId:"",code:"",themeStyle:"--left:#FF5FD2;--right:#B20FD3;--font-color:#B20FD3;"},attached:function(){const{appId:e,ctx:t,imgHeight:s,imgUrl:a,imgWidth:i,sharerUnionId:o,sharerUserId:r,platForm:c,themeConfig:l}=this.data.loginData,{windowHeight:g}=n.f;let d=!1;if(wx.getUserProfile&&(d=!0),this.btnDisabled=!1,this.setData({height:g+"px",appId:e,ctx:t,imgUrl:a,imgWidth:i,imgHeight:s,sharerUnionId:o,sharerUserId:r,canIUseGetUserProfile:d,platForm:c}),l){const{backgroundColor:e,fontColor:t}=l;let s="";e&&(s+=`--background-color:${e};`),t&&(s+=`--font-color:${t};`),this.setData({themeStyle:s})}this.wxLogin(1,(()=>{this.setBtnStatus(!0)})),Object(n.d)("windowHeight",g+"px")},pageLifetimes:{show(){this.wxLogin(1,(()=>{this.setBtnStatus(!0)}))}},methods:{setBtnStatus(e=!0){(this.btnDisabled||!1)!==!e&&(this.btnDisabled=!e)},wxLogin(e=1,t){const s=this,{platForm:a}=this.data;wx["swan"===a?"getLoginCode":"login"]({success(e){s.setData({code:e.code}),t&&t()},fail(e){t&&t()}})},onGetAuthorize(e){let t=this;this.btnDisabled||(this.setBtnStatus(!1),my.getAuthCode({scopes:"auth_base",success:e=>{e.authCode&&(t.data.code=e.authCode,my.getOpenUserInfo({fail:e=>{},success:e=>{const s=JSON.parse(e.response).response,{nickName:a,avatar:n}=s;t.data.loginList={userInfo:{nickName:a,avatarUrl:n}},t.weAppLogin()}}))}}))},getTtUserInfo(e){const t=this;this.btnDisabled||(this.setBtnStatus(!1),tt.authorize({scope:"scope.userInfo",success(){tt.getUserInfo({withCredentials:!0,success(e){const{iv:s,rawData:a,userInfo:n,encryptedData:i,signature:o}=e;t.data.loginList={iv:s,rawData:a,userInfo:n,signature:o,encryptedData:i},t.weAppLogin()},fail(e){}})},fail(){Object(n.a)(t,"scope.userInfo","请先设置允许“真快乐商城”使用您的用户信息",(e=>{t.wxLogin(1)}),(()=>{t.wxLogin(1)}))},complete(){t.setBtnStatus(!0)}}))},getUserProfile(e){let t=this;this.btnDisabled||(this.setBtnStatus(!1),wx.getUserProfile({desc:"用于完善会员资料",success:e=>{t.setBtnStatus(!1);const{iv:s,rawData:a,userInfo:n,signature:i,encryptedData:o}=e,{nickName:r,avatarUrl:c}=n;t.data.loginList={iv:s,rawData:a,userInfo:n,signature:i,encryptedData:o},t.weAppLogin(),t.data.loginList={userInfo:{wxNickName:r,wxAvatarUrl:c}}},complete(){t.setBtnStatus(!0)}}))},getUserInfo(e){if(this.btnDisabled)return;this.setBtnStatus(!1);const{iv:t,rawData:s,userInfo:a,signature:n,encryptedData:i,errMsg:o}=e.detail;this.data.loginList={iv:t,rawData:s,userInfo:a,signature:n,encryptedData:i},o.includes("getUserInfo:ok")?this.weAppLogin():wx.showToast({title:"请授权允许获取昵称和头像后重试！",icon:"none",duration:2e3})},weAppLogin(){const e=this,{appId:t,loginList:s,code:n,sharerUserId:i,sharerUnionId:o,ctx:r}=this.data,{rawData:c,signature:l,encryptedData:g,iv:d,userInfo:p,avatar:u}=s,h={appId:t,rawData:c,signature:l,encryptedData:g,iv:d,code:n,puserId:i,puniqueId:o||"",nickName:p.nickName||s.nickName,avatar:p.avatarUrl||u};wx.showLoading({title:"加载中..."}),a.a.appletLogin(h,r,{success(t){const{data:a,statusCode:n}=t,{code:i,message:o}=a;e.data.code="",wx.hideLoading(),e.triggerEvent("success",{loginList:s,statusCode:n,data:a}),200!=i&&105!=i&&106!=i&&6001!=i&&(wx.showToast({title:o,icon:"none"}),e.wxLogin(1))},fail(){wx.hideLoading(),wx.showToast({title:"登录请求失败, 请检查您的网络后重试",icon:"none",mask:!0})},complete(){e.setBtnStatus(!0)}})},toPage(){const e=getCurrentPages(),t=e[e.length-1].options,s="/packLogin/pages/loginQuick/loginQuick";t.referrer&&(s+=`?referrer=${t.referrer}`),wx.navigateTo({url:s})},toLoginQuick(){const e=getCurrentPages(),t=e[e.length-1].options;this.triggerEvent("navigator",{loginType:"loginQuick",referrer:t?t.referrer:void 0})}}})}},[["../../node_modules/@mpxjs/webpack-plugin/lib/native-loader.js!./src/components/loginCall/index.js?packageName=main","bundle"]]]);